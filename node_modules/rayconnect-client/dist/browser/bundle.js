!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var o,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};o=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function u(){u.init.call(this)}e.exports=u,u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var c=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function h(e,t,n,o){var r,i,s,u;if(a(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,u=c,console&&console.warn&&console.warn(u)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=f.bind(o);return r.listener=n,o.wrapFn=r,r}function p(e,t,n){var o=e._events;if(void 0===o)return[];var r=o[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):y(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),u.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},u.prototype.getMaxListeners=function(){return l(this)},u.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var u=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw u.context=s,u}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)i(c,this,t);else{var a=c.length,l=y(c,a);for(n=0;n<a;++n)i(l[n],this,t)}return!0},u.prototype.addListener=function(e,t){return h(this,e,t,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function(e,t){return h(this,e,t,!0)},u.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},u.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},u.prototype.removeListener=function(e,t){var n,o,r,i,s;if(a(t),void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,r=i;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,s||t)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,i=Object.keys(n);for(o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},u.prototype.listeners=function(e){return p(this,e,!0)},u.prototype.rawListeners=function(e){return p(this,e,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},u.prototype.listenerCount=v,u.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]}},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(2));window.Rayconnect=r.default},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function u(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}c((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(3)),u=n(0),c=function(){function e(e,t,n){var o=this;void 0===e&&(e={scopes:"",appID:"rayconnect",space:"",type:"client"}),this.ops=e,this.token=t,this.config=n,this.authed=!1,this.AuthEvent=new u.EventEmitter,this.InterTime=10,this.Timeout=3e3,this.loginData={username:"",password:""},this.encode=!0,this.InitCloud=!1,this.middlewares=[],this.ObjectIdvalue=function(e){return e.id.toString()},this.ops.url||(this.ops.url="server-test.rayconnect.ir/socket.io/"),console.log(this.ops);var r=this;this.CloudStorage={Keys:new Map,setItem:function(e,t){return r.SetCloudStorage({key:e,value:t})},getItem:function(e){return new Promise((function(t,n){r.InitCloud&&t(r.CloudStorage.Keys.get(e)),setTimeout((function(){n("request timeout")}),2e3);var o=20,i=setInterval((function(){r.InitCloud&&(t(r.CloudStorage.Keys.get(e)),clearInterval(i)),o*=2}),o)}))}},this.socket=this.Connect(),this.OnConnect((function(){})),this.socket.on("app_data",(function(e){0==e.encode&&(o.encode=e.encode)})),this.socket.on("authed",(function(e){var t=o.Dpack(e);o.authed=!0,o.user=t.data,o.AuthEvent.emit("authed",!0)})),this.socket.on("ack_gram",(function(e){o.Dpack(e)})),this.DisOnConnect((function(){o.authed=!1}))}return e.prototype.setProfile=function(e,t){var n=this;return void 0===t&&(t=6e3),new Promise((function(o,r){n.socket.emit("profile",{method:"SET",data:e});var i=setTimeout((function(){r("request timeout : "+t)}),t);n.socket.readData("profile_set",(function(e){o(e),clearTimeout(i)}))}))},e.prototype.CloneCloudStorage=function(e,t){var n=this;return void 0===t&&(t=3e3),new Promise((function(o,r){n.socket.emit("cloud_storage",{method:"CLONE",data:e});var i=setTimeout((function(){r("request timeout : "+t)}),t);n.socket.readData("cloud_storage_cloned",(function(e){o(e),clearTimeout(i)}))}))},e.prototype.SetCloudStorage=function(e,t){var n=this;return void 0===t&&(t=3e3),new Promise((function(o,r){if(["setItem","getItem","removeItem","clear"].includes(e.key))return r("can not use reserved function as data");n.socket.emit("cloud_storage",{method:"SET",data:e});var i=setTimeout((function(){r("request timeout : "+t)}),t);n.socket.readData("cloud_storage_set_"+e.key,(function(t){n.CloudStorage.Keys.set(e.key,e.value),o(t),clearTimeout(i)}))}))},e.prototype.LoadCloudStorage=function(e){var t=this;return void 0===e&&(e=3e3),new Promise((function(n,o){t.socket.emit("cloud_storage",{method:"LOAD"});var r=setTimeout((function(){o("request timeout : "+e)}),e);t.socket.readData("cloud_storage_load",(function(e){n(t.CloudStorage),t.InitCloud=!0,clearTimeout(r),e.forEach((function(e){["setItem","getItem","removeItem","clear"].includes(e.key)||t.CloudStorage.Keys.set(e.key,e.value)}))}))}))},e.prototype.AuthEmitter=function(e){e&&this.AuthEvent.emit("authed",!0)},e.prototype.AuthChecker=function(e){var t=this,n=setInterval((function(){t.authed&&(e(t.authed),clearInterval(n))}),50);setTimeout((function(){e(t.authed),clearInterval(n)}),3e3)},e.prototype.Ack=function(e){this.socket.emit("ack_gram",{reqID:e})},e.prototype.OnConnect=function(e){this.socket.on("connect",(function(){e()}))},e.prototype.RequestOTP=function(e,t){var n=this;return void 0===t&&(t=12e4),this.socket.emit("login",{phone:e}),new Promise((function(e,o){var r=setTimeout((function(){o("request timeout : "+t)}),t);n.socket.readData("login",(function(t){var o=n.Dpack(t);clearTimeout(r),e(o)}))}))},e.prototype.VerifyPhone=function(e,t,n){var o=this;return void 0===n&&(n=12e4),this.socket.emit("login",{phone:e,token:t}),new Promise((function(e,t){var r=setTimeout((function(){t("request timeout : "+n)}),n);o.socket.readData("login",(function(t){var n=o.Dpack(t);clearTimeout(r),e(n)}))}))},e.prototype.GetGuestAccess=function(){return o(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,this.Guest()];case 1:return e=t.sent(),[2,this.Auth(e.data.token)]}}))}))},e.prototype.Guest=function(e){return void 0===e&&(e=3e3),this.LoginWithPassword()},e.prototype.LoginWithPassword=function(e,t){var n=this;return void 0===e&&(e={username:"guest",password:"guest"}),void 0===t&&(t=3e3),this.loginData=e,this.socket.emit("loginup",e),new Promise((function(e,o){var r=setTimeout((function(){o("request timeout : "+t)}),t);n.socket.readData("login",(function(t){var o=n.Dpack(t);clearTimeout(r),e(o)}))}))},e.prototype.LoginEvent=function(e){var t=this;this.socket.on("login",(function(n){var o=t.Dpack(n);e(o)}))},e.prototype.DisOnConnect=function(e){this.socket.on("disconnect",(function(){e()}))},e.prototype.AuthOnConnect=function(e){var t=this;this.socket.on("connect",(function(){t.Auth(e)}))},e.prototype.Auth=function(e){var t=this;return this.socket.emit("auth",{token:e}),new Promise((function(e,n){var o=setTimeout((function(){n("request timeout.")}),5e3);t.AuthEvent.once("authed",(function(){t.LoadCloudStorage().then((function(n){e(t.user)})),clearTimeout(o)}))}))},e.prototype.onAuth=function(e,t){var n,o=this,r=this.Timeout,i=!1;"function"==typeof e?n=e:("checker"!==e&&this.Auth(e),"checker"==e&&(r*=1e4,i=!0),n=t),i&&n(!1);var s=setInterval((function(){o.authed&&(n(!0),clearInterval(s))}),10),u=setTimeout((function(){o.authed||(n(!1),clearInterval(s))}),r);this.socket.on("no_authed",(function(){clearTimeout(u),clearInterval(s),n(!1)}))},e.prototype.NoAuthed=function(e){this.socket.on("no_authed",(function(){e(!1)}))},e.prototype.Reconnect=function(){this.socket.reconnect()},e.prototype.Connect=function(){var e=this.ops.unsecure?"ws://":"wss://",t=""+e+this.ops.url+"?scopes=chat&appID=rayGap&space=chat&type=client&encode=true&EIO=3&transport=websocket";return this.config?(t=""+e+this.ops.url+"?scopes="+this.ops.scopes+"&appID="+this.ops.appID+"&space="+this.ops.space+"&type="+this.ops.type+"&encode="+this.encode+"&EIO=3&transport=websocket",this.token&&(t+="&token="+this.token)):t+="?token="+this.token,this.authed=!1,this.user,this.socket=new s.default(t)},e.prototype.execQuery=function(e){e.info.data=JSON.stringify(e.info.data),this.socket.emit("exec_gram",e)},e.prototype.News=function(e){var t=this;this.socket.on("news",(function(n){return o(t,void 0,void 0,(function(){var t;return r(this,(function(o){return this.Dpack(n),t=this.Dpack(n),e(t),[2]}))}))}))},e.prototype.Request=function(e,t,n){var i=this;return void 0===n&&(n=3e3),new Promise((function(s,u){if(!i.authed)return u("not authed");var c=setTimeout((function(){u("request timeout : "+n)}),n);i.execQuery(e),i.socket.readData("blocked",(function(){u("blocked "),clearTimeout(c)})),i.socket.readData("exec_gram_"+t.address,(function(n){return o(i,void 0,void 0,(function(){var o=this;return r(this,(function(r){return this.executeMiddleware(this.middlewares,{query:t,exec:e,msg:n},(function(e,r){try{var i=o.Dpack(n);if(i.scope===t.scope&&i.address===t.address&&i.info.method===t.method){o.Ack(i.info.reqID),clearTimeout(c);var a={sender:i.uid,token:i.token,data:JSON.parse(i.info.data),date:i.info.date,send:function(e,n){o.execQuery({scope:t.scope,uniqueID:n?"*":i.sender,TokenID:n?i.token:"*",address:t.address+"/back",info:{method:t.method,data:e}})}};s(a)}}catch(e){u(e)}})),[2]}))}))}))}))},e.prototype.RequestBack=function(e,t){var n=this;void 0===t&&(t=3e3);var i={scope:e.scope,address:e.address+"/back",method:e.info.method};return new Promise((function(s,u){if(!n.authed)return u("not authed");var c=setTimeout((function(){u("request timeout : "+t)}),t);n.execQuery(e),n.socket.readData("blocked",(function(){u("blocked "),clearTimeout(c)})),n.socket.readData("exec_gram_"+i.address,(function(t){return o(n,void 0,void 0,(function(){var n=this;return r(this,(function(o){return this.executeMiddleware(this.middlewares,{query:i,exec:e,msg:t},(function(e,o){try{var r=n.Dpack(t);if(r.scope===i.scope&&r.address===i.address&&r.info.method===i.method){n.Ack(r.info.reqID),clearTimeout(c);var a={sender:r.uid,token:r.token,data:JSON.parse(r.info.data),date:r.info.date,send:function(e,t){n.execQuery({scope:i.scope,uniqueID:t?"*":r.sender,TokenID:t?r.token:"*",address:i.address+"/back",info:{method:i.method,data:e}})}};s(a)}}catch(e){u(e)}})),[2]}))}))}))}))},e.prototype.Query=function(e,t){var n=this;this.authed?this.socket.on("exec_gram_"+e.address,(function(i){return o(n,void 0,void 0,(function(){var n,o,s=this;return r(this,(function(r){try{(n=this.Dpack(i)).scope===e.scope&&n.address===e.address&&n.info.method===e.method&&(this.Ack(n.info.reqID),o=function(t,o){s.execQuery({scope:e.scope,uniqueID:o?"*":n.sender,TokenID:o?n.token:"*",address:e.address+"/back",info:{method:e.method,data:t}})},this.executeMiddleware(this.middlewares,{query:e,msg:i,send:o},(function(r,i){t({sender:n.uid,token:n.token,data:JSON.parse(n.info.data),date:n.info.date,send:o},e)})))}catch(e){console.error(e)}return[2]}))}))})):console.error("cannot exec without auth")},e.prototype.addUser=function(e){var t=this;return new Promise((function(n,o){t.socket.emit("add_user",e);var r=setTimeout((function(){o("not answer")}),3e3);t.socket.on("added_user",(function(e){var o=t.Dpack(e);clearTimeout(r),n(o)}))}))},e.prototype.changePermissions=function(e){var t=this,n=this;return new Promise((function(o,r){n.socket.emit("change_permissions",e);var i=t.RejectChangePermissionRequest(r);t.AcceptChangePermissionRequest(n,i,o)}))},e.prototype.AcceptChangePermissionRequest=function(e,t,n){e.socket.readData("changed_permission",(function(e){clearTimeout(t),n(e)}))},e.prototype.RejectChangePermissionRequest=function(e){return setTimeout((function(){e("not answer")}),3e3)},e.prototype.updatePassword=function(e){var t=this;return new Promise((function(n,o){t.socket.emit("update_password",e);var r=setTimeout((function(){o("not answer")}),3e3);t.socket.on("updated_password",(function(e){var o=t.Dpack(e);clearTimeout(r),n(o)}))}))},e.prototype.use=function(e){this.middlewares.push(e)},e.prototype.executeMiddleware=function(e,t,n){e.reduceRight((function(e,n){return function(o){n(t,e)}}),n)(t)},e.prototype.Dpack=function(e){return e},e}();t.default=c},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=o(n(4)),s="undefined"==typeof window,u=void 0;s&&(u=n(5));var c=function(){function e(e){this.event=new r.EventEmitter,this.autoReconnectInterval=1e4;var t=this;this.ws=s?new i.default(e,[],{WebSocket:u}):new i.default(e,[]),this.ws.addEventListener("close",(function(e){e.code,clearInterval(t.globalInterval),t.event.emit("disconnect")})),this.ws.onerror=function(e){e.code,clearInterval(t.globalInterval)},this.ws.addEventListener("open",(function(){try{setInterval((function(){t.send("2"),t.globalInterval=setInterval((function(){clearInterval(t.globalInterval),t.event.emit("disconnect"),t.reconnect()}),3e4)}),25e3)}catch(e){}})),this.ws.addEventListener("message",(function(e){try{if(e.data.startsWith("3")&&clearInterval(t.globalInterval),e.data.startsWith("2")&&t.send("3"),e.data.startsWith("0")){var n=JSON.parse(e.data.substring(1));t.event.emit("APP_INIT",n)}if(e.data.startsWith("40")&&t.event.emit("connect",t),e.data.startsWith("41")&&(setTimeout((function(){t.reconnect()}),1e3),t.event.emit("disconnect"),clearInterval(t.globalInterval)),e.data.startsWith("42")){n=JSON.parse(e.data.substring(2));t.event.emit(n[0],n[1])}}catch(e){}}))}return e.prototype.reconnect=function(){clearInterval(this.globalInterval),this.ws.reconnect()},e.prototype.send=function(e){1==this.ws.readyState&&this.ws.send(e)},e.prototype.emit=function(e,t){var n=this;if(1!=this.ws.readyState)var o=setInterval((function(){try{0!=n.ws.readyState&&(n.send('42["'+e+'", '+JSON.stringify(t)+"]"),clearInterval(o))}catch(e){}}),10);else try{this.send('42["'+e+'", '+JSON.stringify(t)+"]")}catch(e){}},e.prototype.on=function(e,t){return this.event.on(e,t)},e.prototype.once=function(e,t){return this.event.once(e,t)},e.prototype.off=function(e,t){return this.event.off(e,t)},e.prototype.close=function(){return this.ws.close()},e.prototype.readData=function(e,t){var n=this;return this.event.once(e,(function(o){return t(o),n.event.off(e,t)}))},e}();t.default=c},function(e,t,n){"use strict";n.r(t);var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s}function s(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}var u=function(e,t){this.target=t,this.type=e},c=function(e){function t(t,n){var o=e.call(this,"error",n)||this;return o.message=t.message,o.error=t,o}return r(t,e),t}(u),a=function(e){function t(t,n,o){void 0===t&&(t=1e3),void 0===n&&(n="");var r=e.call(this,"close",o)||this;return r.wasClean=!0,r.code=t,r.reason=n,r}return r(t,e),t}(u),l=function(){if("undefined"!=typeof WebSocket)return WebSocket},h={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},f=function(){function e(e,t,n){var o=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){o._debug("open event");var t=o._options.minUptime,n=void 0===t?h.minUptime:t;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout((function(){return o._acceptOpen()}),n),o._ws.binaryType=o._binaryType,o._messageQueue.forEach((function(e){return o._ws.send(e)})),o._messageQueue=[],o.onopen&&o.onopen(e),o._listeners.open.forEach((function(t){return o._callEventListener(e,t)}))},this._handleMessage=function(e){o._debug("message event"),o.onmessage&&o.onmessage(e),o._listeners.message.forEach((function(t){return o._callEventListener(e,t)}))},this._handleError=function(e){o._debug("error event",e.message),o._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),o.onerror&&o.onerror(e),o._debug("exec error listeners"),o._listeners.error.forEach((function(t){return o._callEventListener(e,t)})),o._connect()},this._handleClose=function(e){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(e),o._listeners.close.forEach((function(t){return o._callEventListener(e,t)}))},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){return this._messageQueue.reduce((function(e,t){return"string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e}),0)+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(e,t),this._connect()):this._connect()},e.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,n=void 0===t?h.maxEnqueuedMessages:t;this._messageQueue.length<n&&(this._debug("enqueue",e),this._messageQueue.push(e))}},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t,n,o=this._listeners[e.type];if(o)try{for(var r=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}(o),i=r.next();!i.done;i=r.next()){var s=i.value;this._callEventListener(e,s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((function(e){return e!==t})))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,s(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?h.reconnectionDelayGrowFactor:t,o=e.minReconnectionDelay,r=void 0===o?h.minReconnectionDelay:o,i=e.maxReconnectionDelay,s=void 0===i?h.maxReconnectionDelay:i,u=0;return this._retryCount>0&&(u=r*Math.pow(n,this._retryCount-1))>s&&(u=s),this._debug("next delay",u),u},e.prototype._wait=function(){var e=this;return new Promise((function(t){setTimeout(t,e._getNextDelay())}))},e.prototype._getNextUrl=function(e){if("string"==typeof e)return Promise.resolve(e);if("function"==typeof e){var t=e();if("string"==typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,o=void 0===n?h.maxRetries:n,r=t.connectionTimeout,i=void 0===r?h.connectionTimeout:r,s=t.WebSocket,u=void 0===s?l():s;if(this._retryCount>=o)this._debug("max retries reached",this._retryCount,">=",o);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),void 0===(c=u)||!c||2!==c.CLOSING)throw Error("No valid WebSocket class provided");var c;this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new u(t,e._protocols):new u(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),i))}))}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new c(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new a(e,t,this))}catch(e){}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}();t.default=f},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}]);